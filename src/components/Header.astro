---
import { LOGO_IMAGE, SITE } from "@config";
import Hr from "./Hr.astro";
import LinkButton from "./LinkButton.astro";

export interface Props {
  activeNav?: "posts" | "tags" | "about" | "search";
}

const { activeNav } = Astro.props;
---

<header class="glass sticky top-0 z-40 border-b border-white/20">
  <a
    id="skip-to-content"
    href="#main-content"
    class="glass sr-only rounded-lg px-4 py-2 text-skin-accent focus:not-sr-only focus:absolute focus:left-4 focus:top-4"
    >跳转到内容</a
  >
  <div class="nav-container">
    <div class="top-nav-wrap">
      <a
        href="/"
        class="logo gradient-text whitespace-nowrap text-2xl font-bold transition-transform duration-300 hover:scale-105"
      >
        {
          LOGO_IMAGE.enable ? (
            <img
              src={`/assets/${LOGO_IMAGE.svg ? "logo.svg" : "logo.png"}`}
              alt={SITE.title}
              width={LOGO_IMAGE.width}
              height={LOGO_IMAGE.height}
              class="transition-transform duration-300 hover:scale-110"
            />
          ) : (
            SITE.title
          )
        }
      </a>
      <nav id="nav-menu">
        <button
          class="hamburger-menu focus-outline glass rounded-lg p-2 transition-all duration-300 hover:bg-skin-accent hover:text-white"
          aria-label="打开菜单"
          aria-expanded="false"
          aria-controls="menu-items"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="menu-icon"
          >
            <line x1="7" y1="12" x2="21" y2="12" class="line"></line>
            <line x1="3" y1="6" x2="21" y2="6" class="line"></line>
            <line x1="12" y1="18" x2="21" y2="18" class="line"></line>
            <line x1="18" y1="6" x2="6" y2="18" class="close"></line>
            <line x1="6" y1="6" x2="18" y2="18" class="close"></line>
          </svg>
        </button>
        <ul id="menu-items" class="display-none items-center gap-6 sm:flex">
          <li>
            <a
              href="/posts/"
              class={`nav-link ${activeNav === "posts" ? "active" : ""}`}
            >
              文章
            </a>
          </li>
          <li>
            <a
              href="/tags/"
              class={`nav-link ${activeNav === "tags" ? "active" : ""}`}
            >
              标签
            </a>
          </li>
          <li>
            <a
              href="/about/"
              class={`nav-link ${activeNav === "about" ? "active" : ""}`}
            >
              关于
            </a>
          </li>
          <li>
            <LinkButton
              href="/search/"
              className={`focus-outline glass rounded-lg p-3 transition-all duration-300 hover:bg-skin-accent hover:text-white sm:p-2 ${
                activeNav === "search" ? "active" : ""
              } flex`}
              ariaLabel="搜索"
              title="搜索"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="scale-125 sm:scale-100"
                ><path
                  d="M19.023 16.977a35.13 35.13 0 0 1-1.367-1.384c-.372-.378-.596-.653-.596-.653l-2.8-1.337A6.962 6.962 0 0 0 16 9c0-3.859-3.14-7-7-7S2 5.141 2 9s3.14 7 7 7c1.763 0 3.37-.66 4.603-1.739l1.337 2.8s.275.224.653.596c.387.363.896.854 1.384 1.367l1.358 1.392.604.646 2.121-2.121-.646-.604c-.379-.372-.885-.866-1.391-1.36zM9 14c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5z"
                ></path>
              </svg>
              <span class="sr-only">搜索</span>
            </LinkButton>
          </li>
          {
            SITE.lightAndDarkMode && (
              <li>
                <button
                  id="theme-btn"
                  class="focus-outline glass rounded-lg p-2 transition-all duration-300 hover:bg-skin-accent hover:text-white"
                  title="切换明暗主题"
                  aria-label="自动"
                  aria-live="polite"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                    id="moon-svg"
                    class="astro-moon"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />
                  </svg>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                    id="sun-svg"
                    class="astro-sun"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <circle cx="12" cy="12" r="4" />
                    <path d="M12 2v2" />
                    <path d="M12 20v2" />
                    <path d="m4.93 4.93 1.41 1.41" />
                    <path d="m17.66 17.66 1.41 1.41" />
                    <path d="M2 12h2" />
                    <path d="M20 12h2" />
                    <path d="m6.34 17.66-1.41 1.41" />
                    <path d="m19.07 4.93-1.41 1.41" />
                  </svg>
                </button>
              </li>
            )
          }
        </ul>
      </nav>
    </div>
  </div>
  <Hr />
</header>

<style>
  header {
    @apply border-b border-white/20 bg-white/10 backdrop-blur-md;
  }

  .nav-container {
    @apply mx-auto max-w-4xl px-4;
  }

  .top-nav-wrap {
    @apply flex items-center justify-between py-4;
  }

  .logo {
    @apply text-2xl font-bold transition-transform duration-300 hover:scale-105;
    background: linear-gradient(to right, #6366f1, #8b5cf6, #ec4899);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .nav-link {
    @apply rounded-lg px-4 py-2 font-medium text-skin-base transition-all duration-300 hover:bg-skin-accent/10 hover:text-skin-accent;
  }

  .nav-link.active {
    @apply bg-skin-accent/10 font-semibold text-skin-accent;
  }

  .hamburger-menu {
    @apply sm:hidden;
  }

  #menu-items {
    @apply sm:flex sm:items-center sm:gap-6;
  }

  @media (max-width: 640px) {
    #menu-items {
      @apply absolute left-0 right-0 top-full flex-col gap-0 border-b border-white/20;
      backdrop-filter: blur(12px);
      background-color: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    #menu-items li {
      @apply w-full;
    }

    #menu-items a,
    #menu-items button {
      @apply w-full border-b border-white/10 px-4 py-3 text-left last:border-b-0;
    }
  }

  .menu-icon {
    @apply transition-all duration-300;
  }

  .menu-icon .line {
    @apply transition-all duration-300;
  }

  .menu-icon .close {
    @apply opacity-0 transition-all duration-300;
  }

  .menu-icon.active .line {
    @apply opacity-0;
  }

  .menu-icon.active .close {
    @apply opacity-100;
  }
</style>

<script is:inline>
  const hamburgerMenu = document.querySelector(".hamburger-menu");
  const menuItems = document.querySelector("#menu-items");
  const menuIcon = document.querySelector(".menu-icon");

  hamburgerMenu?.addEventListener("click", () => {
    const isExpanded = hamburgerMenu.getAttribute("aria-expanded") === "true";
    hamburgerMenu.setAttribute("aria-expanded", !isExpanded);
    menuItems?.classList.toggle("display-none");
    menuIcon?.classList.toggle("active");
  });

  // 关闭移动端菜单当点击外部
  document.addEventListener("click", e => {
    if (
      !hamburgerMenu?.contains(e.target as Node) &&
      !menuItems?.contains(e.target as Node)
    ) {
      hamburgerMenu?.setAttribute("aria-expanded", "false");
      menuItems?.classList.add("display-none");
      menuIcon?.classList.remove("active");
    }
  });
</script>
